# F1 遥测可视化系统设计方案 (高级车队管理与直播级)

本方案基于 F1 2025 UDP 协议，旨在为专业车队工程师及直播解说提供全方位的赛场洞察、深度遥测对比及历史数据管理功能。

---

### 1. 全局布局框架 (Global Layout)

系统采用功能高度集约的**四栏式专业结构**：

*   **顶部状态栏 (Header Bar)**：
    *   **模式切换**：支持 `LIVE` (实时接收) 与 `REPLAY` (历史回顾) 模式切换。
    *   **Session 管理**：显示当前赛道、Session 类型及剩余时间。提供齿轮图标进入“历史数据管理中心”。
    *   **时间轴控制器 (Global Scrubber)**：
        *   在 `REPLAY` 模式下出现在屏幕底部，支持拖动跳转至任意比赛时刻。
        *   **播放控制 (Playback Controls)**：新增播放/暂停切换按钮。
            *   **播放 (Play)**：历史数据按现实时间比例自动滚动。
            *   **暂停 (Pause)**：画面定格在当前时间点，方便进行静态遥测分析。
            *   **倍速 (Speed)**：支持 1x, 2x, 5x, 10x 播放速度。
*   **左侧：多维动态排名塔 (Timing Tower)**：
    *   **默认状态**：初始为**折叠模式 (Collapsed)**。
        *   **宽度控制**：
            *   **动态伸缩**：侧边栏宽度根据全场最大轮胎套数动态计算（基础宽度 320px + 额外轮胎套数 * 28px）。
        *   **单行流式布局 (Single-Row Flow)**：
            *   **名字区域 (Name)**：预留 110px 宽度，支持更长的名字显示。
            *   **垂直分割线**：位于名字右侧 (155px 偏移)。
            *   **间隔时间 (Gap)**：位于 162px 偏移，分两行显示。
            *   **轮胎历史 (Tyre)**：位于 235px 偏移。
        *   **复合状态点优先级 (Status Priority)**：
            1.  **Flag**：Y/B 旗帜形状，高频闪烁。
            2.  **Pit**：橙色圆圈 P。
            3.  **DRS**：绿色圆圈/实心圆 D。
            4.  **Track Status**：纯文本/符号标签，不画圈。
                *   **FLY**：紫色文本，带 Alpha 闪烁。
                *   **>> (In Lap)**：白色符号，静态。
                *   **<< (Out Lap)**：白色符号，静态。
    *   **展开模式 (Expanded Mode)**：
        *   **宽度控制**：侧边栏平滑扩展至约 500px。
        *   **组件化布局 (Non-Table Components)**：
            *   **扇区计时条 (Sector Timeline)**：在名字下方显示 S1/S2/S3 三段式进度条。
                *   紫色：全场最快；绿色：个人最快；黄色：普通。
            *   **车辆遥测 (Car Telemetry)**：
                *   **ERS 能量条**：紧凑的水平进度条，显示能量回收状态。
                *   **核心数据**：车速、转速、油耗以微型数值显示在组件间隙。
            *   **圈速趋势图 (Lap Trends)**：底部显示过去 5-10 圈的极简折线图 (Sparkline)。
    *   **智能双选逻辑**：默认锁定前两名。手动选中时，排名靠前者自动设为 **Driver A (青色)**，靠后者设为 **Driver B (品红色)**。

---

### 2. 中间核心区：遥测对比台 (Telemetry Console, 50% 宽度)

#### **常驻遥测对比区 (Telemetry Plots)**
*   **多层重叠图表**：垂直堆叠速度、油门/刹车、ERS 部署等同步 X 轴曲线。
*   **Delta-Time 深度对比图**：在遥测区最下方增加常驻 Delta 曲线。
    *   **实时增益/损失**：展示 A 与 B（或当前圈与参考圈）在每一米赛道上的时间得失。
    *   **斜率分析**：通过曲线斜率直观判断在哪个弯道或直道损失了更多时间。
*   **距离基准对齐**：强制使用“赛道距离”作为 X 轴，确保不同圈数/车手数据在弯心点完美对齐。
*   **多维回溯**：A/B 独立下拉框，支持 `Live`、`Best Lap` 或特定历史圈数的交叉对比。

---

### 3. 右侧栏：情报与事件 (Intelligence Sidecar, 20% 宽度)

#### **上半部分：环境与天气预报 (Environment & Weather)**
*   **降雨雷达**：未来 5/15/30 分钟降雨概率曲线。
*   **气象监测**：实时环境/赛道温度、风速风向及抓地力趋势预测。

#### **下半部分：事件日志 (Event Ticker)**
*   **交互式日志流**：滚动记录最快圈、碰撞、退赛、处罚及超车事件。
*   **回顾联动**：在回顾模式下，点击特定事件条目，系统自动将全局时间轴跳转至该事件发生时刻。

---

### 4. 历史数据管理中心 (Data Management)

*   **Session 浏览器**：列表化展示所有已保存的历史比赛。
*   **清理功能**：提供删除按钮及批量清理选项，支持安全二次确认，物理删除底层遥测数据以释放空间。
*   **跨场对比**：支持将当前实时数据与历史数据库中的任意 Session 进行对比（如：对比今年与去年同一弯道的制动表现）。

---

### 5. 数据架构设计 (Data Architecture)

为保证系统的高响应性和大数据量处理能力，采用“双路并行”架构：

*   **实时路径 (Live Path)**：UDP 数据包进入系统后，直接存入内存中的**循环缓冲区 (Ring Buffer)**，由 GUI 线程直接读取渲染。确保零延迟、60FPS 的平滑监控。
*   **持久化路径 (Archive Path)**：后台线程异步将数据包写入数据库，不干扰实时渲染流程。
*   **回顾路径 (Replay Path)**：仅在 `REPLAY` 模式或“历史圈数对比”触发时，系统从数据库按需加载数据至内存进行渲染。

---

### 6. 专业进阶功能 (Advanced Engineering Features)

为达到工业级遥测标准，系统集成以下高级辅助功能：

*   **Delta-Time 深度分析**：实时计算并展示当前圈与参考圈（如全场最快圈）在每一米赛道上的时间得失。
*   **进站排位预测 (Pit Exit Position)**：动态计算当前进站后的预计出弯排名及与周围车辆的间距。
*   **燃油与节能建议 (Fuel Management)**：根据实时消耗预测完赛概率，并计算每圈所需的“抬油滑行 (Lift-and-Coast)”距离。
*   **跨设备分发 (Multi-Device Sync)**：通过 WebSocket 将核心排名与天气数据分发至移动端浏览器，实现多屏联动监控。

---

### 7. 总结：可视化软件的三个层次

1.  **初级（辅助驾驶）**：提供 HUD 之外的信息补充，如精确燃油余量和轮胎温度。
2.  **中级（性能提升）**：通过对比历史圈数，分析刹车点和油门时机的优劣。
3.  **高级（车队管理/直播）**：本方案所选层次。提供全局视角、双车深度对决分析、环境预测及历史复盘管理，达到专业车队策略软件标准。